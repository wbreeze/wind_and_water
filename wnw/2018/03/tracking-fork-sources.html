<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet"
   href="https://fonts.googleapis.com/css?family=Lato|Roboto+Slab"><!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Tracking the source of a fork | Wind and Water</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Tracking the source of a fork" />
<meta name="author" content="Douglas Lovell" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="In Ruby land, we usually take advantage of open source through the published gems. Sometimes however, it’s nice to use open source from the source. Sometimes you want to run off of a fork, but track changes and improvements made to the source. Here are a couple of scenarios:" />
<meta property="og:description" content="In Ruby land, we usually take advantage of open source through the published gems. Sometimes however, it’s nice to use open source from the source. Sometimes you want to run off of a fork, but track changes and improvements made to the source. Here are a couple of scenarios:" />
<link rel="canonical" href="http://localhost:4000/2018/03/tracking-fork-sources.html" />
<meta property="og:url" content="http://localhost:4000/2018/03/tracking-fork-sources.html" />
<meta property="og:site_name" content="Wind and Water" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-03-21T00:00:00-03:00" />
<script type="application/ld+json">
{"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2018/03/tracking-fork-sources.html"},"url":"http://localhost:4000/2018/03/tracking-fork-sources.html","author":{"@type":"Person","name":"Douglas Lovell"},"description":"In Ruby land, we usually take advantage of open source through the published gems. Sometimes however, it’s nice to use open source from the source. Sometimes you want to run off of a fork, but track changes and improvements made to the source. Here are a couple of scenarios:","@type":"BlogPosting","headline":"Tracking the source of a fork","dateModified":"2018-03-21T00:00:00-03:00","datePublished":"2018-03-21T00:00:00-03:00","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<style type='text/css'>
    <!-- this is here because scss doesn't process the liquid filter -->
    body {
      background-image: url("/assets/paperbg.png");
    }
  </style>
  <link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Wind and Water" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Wind and Water</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a><a class="page-link" href="/posts/">Posts</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <section class='col span_1_of_4 post-list left-sidebar'>
  
    <h2 class="post-list-heading">Posts</h2>
    <ul class="post-list">
      
      <li>
        
        <span class="post-meta">Jan 9, 2019</span>
        <h3>
          <a class="post-link" href="/2019/01/sccm-and-git.html">
            SCCM and Git
          </a>
        </h3>
      </li>
      
      <li>
        
        <span class="post-meta">Apr 17, 2018</span>
        <h3>
          <a class="post-link" href="/2018/04/co-routines.html">
            Coroutines
          </a>
        </h3>
      </li>
      
      <li>
        
        <span class="post-meta">Apr 5, 2018</span>
        <h3>
          <a class="post-link" href="/2018/04/dock-io.html">
            Your Professional Pedigree
          </a>
        </h3>
      </li>
      
      <li>
        
        <span class="post-meta">Mar 21, 2018</span>
        <h3>
          <a class="post-link" href="/2018/03/tracking-fork-sources.html">
            Tracking the source of a fork
          </a>
        </h3>
      </li>
      
      <li>
        
        <span class="post-meta">Mar 18, 2018</span>
        <h3>
          <a class="post-link" href="/2018/03/the-dispossessed.html">
            The Dispossessed
          </a>
        </h3>
      </li>
      
      <li>
        
        <span class="post-meta">Mar 16, 2018</span>
        <h3>
          <a class="post-link" href="/2018/03/why-i-dont-use-fb.html">
            Why I&#39;m not on Facebook
          </a>
        </h3>
      </li>
      
      <li>
        
        <span class="post-meta">Mar 9, 2018</span>
        <h3>
          <a class="post-link" href="/2018/03/merging-structure.html">
            Merging migrations
          </a>
        </h3>
      </li>
      
      <li>
        
        <span class="post-meta">Mar 8, 2018</span>
        <h3>
          <a class="post-link" href="/2018/03/rebase-v-merge.html">
            Git merge v. rebase
          </a>
        </h3>
      </li>
      
      <li>
        
        <span class="post-meta">Feb 23, 2018</span>
        <h3>
          <a class="post-link" href="/2018/02/have-http-status.html">
            RSpec have HTTP status upgrade
          </a>
        </h3>
      </li>
      
    </ul>

    <p class="rss-subscribe">subscribe <a href="/feed.xml">via RSS</a></p>
  
</section>
<article class="post h-entry col span_3_of_4"
  itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Tracking the source of a fork</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2018-03-21T00:00:00-03:00" itemprop="datePublished">Mar 21, 2018
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>In Ruby land, we usually take advantage of open source through the
published gems. Sometimes however, it’s nice to use open source from the source.
Sometimes you want to run off of a fork, but track
changes and improvements made to the source.
Here are a couple of scenarios:</p>

<ul>
  <li>You need to make some changes for your project that don’t have a prayer
of making it back into the source. That is, you expect to run from the
fork more or less permanently, without requesting the source provider to
pull your very specialized changes.</li>
  <li>You don’t trust the source not to disappear, or not to quietly introduce
malicious code in an update.</li>
</ul>

<p>How do you have your cake and eat it too? How do you run a customized
fork while tracking improvements made to the original?</p>

<p>One way to do this is to fork the source, make a production branch
for your localized modifications, and have the master branch track
the source.
With this setup, you can pull source improvements in the master branch,
then merge or cherry-pick those into your production branch.</p>

<p>Here’s how it works. We’re going to pick-up an Ansible role from GitHub.
Let’s use, <code class="highlighter-rouge">cdriehuys/ansible-role-lock-root</code>.</p>

<p>First, fork the role in GitHub. The name of our fork is,
<code class="highlighter-rouge">TelegraphyInteractive/ansible-role-lock-root</code>.</p>

<p>Now we clone:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~/ansible/roles$ git clone \
&gt; git@github.com:TelegraphyInteractive/ansible-role-lock-root.git lock-root
Cloning into 'lock-root'...
~/ansible/roles$ cd lock-root
~/ansible/roles/lock-root[master]$
</code></pre></div></div>

<p>We cloned inside of the <code class="highlighter-rouge">roles</code> directory of our Ansible playbook, but
that is an irrelevant detail. We also changed the name to keep it short.
The cloned repository exists in directory, <code class="highlighter-rouge">~/ansible/roles/lock-root</code>.</p>

<p>The <code class="highlighter-rouge">git config -l</code> output contains these <code class="highlighter-rouge">remote</code> and <code class="highlighter-rouge">branch</code>
settings:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>remote.origin.url=git@github.com:TelegraphyInteractive/ansible-role-lock-root.git
remote.origin.fetch=+refs/heads/*:refs/remotes/origin/*
branch.master.remote=origin
branch.master.merge=refs/heads/master
</code></pre></div></div>

<p>We want at least one branch to track the master branch from the original
source, <code class="highlighter-rouge">cdriehuys/ansible-role-lock-root</code>. In order to do this, we first
have to make that repository available as a remote.
We create a remote called, <code class="highlighter-rouge">source</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~/ansible/roles/lock-root[master]$ git remote add \
&gt; -m master -t master \
&gt; source 'git@github.com:cdriehuys/ansible-role-lock-root.git'
</code></pre></div></div>

<p>The <code class="highlighter-rouge">git config -l</code> output now contains the additional remote
called, <code class="highlighter-rouge">source</code>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>remote.origin.url=git@github.com:TelegraphyInteractive/ansible-role-lock-root.git
remote.origin.fetch=+refs/heads/*:refs/remotes/origin/*
branch.master.remote=origin
branch.master.merge=refs/heads/master
remote.source.url=git@github.com:cdriehuys/ansible-role-lock-root.git
remote.source.fetch=+refs/heads/master:refs/remotes/source/master
</code></pre></div></div>

<p>We want to make the master branch track the source from <code class="highlighter-rouge">cdriehuys</code>.
First we fetch the branches from the source, then set the upstream
branch for master.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~/ansible/roles/lock-root[master]$ git fetch --all
Fetching origin
Fetching source
From github.com:cdriehuys/ansible-role-lock-root
 * [new branch]      master     -&gt; source/master
~/ansible/roles/lock-root[master]$ git branch --set-upstream-to=source/master
Branch 'master' set up to track remote branch 'master' from 'source'.
</code></pre></div></div>

<p>The <code class="highlighter-rouge">git config -l</code> output shows that the master branch now tracks
the master branch from <code class="highlighter-rouge">cdriehuys</code>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>remote.origin.url=git@github.com:TelegraphyInteractive/ansible-role-lock-root.git
remote.origin.fetch=+refs/heads/*:refs/remotes/origin/*
branch.master.remote=source
branch.master.merge=refs/heads/master
remote.source.url=git@github.com:cdriehuys/ansible-role-lock-root.git
remote.source.fetch=+refs/heads/master:refs/remotes/source/master
</code></pre></div></div>

<p>Note that the master branch is now “read-only.” We won’t be able to push
from the master branch, because we do not have write access to the source
repository. We <strong>can</strong> however do <code class="highlighter-rouge">git pull</code>. The pull will bring any upstream
changes from <code class="highlighter-rouge">cdriehuys</code> into our workspace.</p>

<p>The only thing left to do is make our own branch based on our own repository,
so that we can make changes. Let’s call the branch, <code class="highlighter-rouge">production</code>.
First we create the branch and switch to it at the same time.
Next we push the branch to our own repository, the <code class="highlighter-rouge">origin</code> and set
that as the “default,” upstream branch for all future pushes.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~/ansible/roles/lock-root[master]$ git checkout -b production
Switched to a new branch 'production'
~/ansible/roles/lock-root[production]$ git push --set-upstream origin production
Total 0 (delta 0), reused 0 (delta 0)
To github.com:TelegraphyInteractive/ansible-role-lock-root.git
 * [new branch]      production -&gt; production
Branch 'production' set up to track remote branch 'production' from 'origin'.
</code></pre></div></div>

<p>The output of <code class="highlighter-rouge">git config -l</code> now shows the new <code class="highlighter-rouge">production</code> branch
tracking our own repository.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>remote.origin.url=git@github.com:TelegraphyInteractive/ansible-role-lock-root.git
remote.origin.fetch=+refs/heads/*:refs/remotes/origin/*
branch.master.remote=source
branch.master.merge=refs/heads/master
remote.source.url=git@github.com:cdriehuys/ansible-role-lock-root.git
remote.source.fetch=+refs/heads/master:refs/remotes/source/master
branch.production.remote=origin
branch.production.merge=refs/heads/production
</code></pre></div></div>

<p>When we want to pull upstream changes, we go to the master branch
and pull them.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~/ansible/roles/lock-root[production]$ git checkout master
Switched to branch 'master'
Your branch is up to date with 'source/master'.
~/ansible/roles/lock-root[master]$ git pull
Already up to date.
</code></pre></div></div>

<p>We can now get a view of the changes made upstream on the master
through <code class="highlighter-rouge">git log</code> and <code class="highlighter-rouge">git diff</code>.</p>

<p>Satisfied with the changes, we can merge, cherry-pick or
<a href="/2018/03/rebase-v-merge.html">(gulp) rebase</a>
the changes we have in production:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~/ansible/roles/lock-root[master]$ git checkout production
Switched to branch 'production'
Your branch is up to date with 'origin/production'.
~/ansible/roles/lock-root[production]$ git merge master
Already up to date.
</code></pre></div></div>

<p>This gives us the best of two worlds, don’t you think?
Who says you can’t have your cake and eat it too?</p>

<p>Well. There’s one source of error.  Now it’s necessary to leave
the directory checked-out to the production branch. If we accidentally
leave it checked-out to the master branch, all of our hard work will
be for naught, and we might face some confusing errors.</p>

<p>The other complication is that we’ll now have to work with
<a href="https://git-scm.com/book/en/v2/Git-Tools-Submodules">git submodules</a>.
Assuming the project we are working is under source control with git,
we’ve just checked-out another git repository within it.</p>

<p>There’s some care required with making changes to submodules in a project.
If it isn’t worth the trouble, forget everything you’ve read and copy copy
copy! (It’s the sincerest form of flattery.)</p>

  </div><a class="u-url" href="/2018/03/tracking-fork-sources.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Wind and Water</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Douglas Lovell</li><li><a class="u-email" href="mailto:doug@wbreeze.com">doug@wbreeze.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/wbreeze"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">wbreeze</span></a></li><li><a href="/feed.xml"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#rss"></use></svg> <span>rss</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>The fascination of what&#39;s difficult...</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
