<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet"
   href="https://fonts.googleapis.com/css?family=Lato|Roboto+Slab"><!-- Begin Jekyll SEO tag v2.5.0 -->
<title>SCCM and Git | Wind and Water</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="SCCM and Git" />
<meta name="author" content="Douglas Lovell" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="There are files in our software systems that we desire to have under source control, but which we never edit. These are source code configuration management (SCCM) files such as Gemfile.lock, npm.shrinkwrap.json, or db/schema.rb." />
<meta property="og:description" content="There are files in our software systems that we desire to have under source control, but which we never edit. These are source code configuration management (SCCM) files such as Gemfile.lock, npm.shrinkwrap.json, or db/schema.rb." />
<link rel="canonical" href="http://localhost:4000/2019/01/sccm-and-git.html" />
<meta property="og:url" content="http://localhost:4000/2019/01/sccm-and-git.html" />
<meta property="og:site_name" content="Wind and Water" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-01-09T00:00:00-03:00" />
<script type="application/ld+json">
{"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2019/01/sccm-and-git.html"},"url":"http://localhost:4000/2019/01/sccm-and-git.html","author":{"@type":"Person","name":"Douglas Lovell"},"description":"There are files in our software systems that we desire to have under source control, but which we never edit. These are source code configuration management (SCCM) files such as Gemfile.lock, npm.shrinkwrap.json, or db/schema.rb.","@type":"BlogPosting","headline":"SCCM and Git","dateModified":"2019-01-09T00:00:00-03:00","datePublished":"2019-01-09T00:00:00-03:00","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<style type='text/css'>
    <!-- this is here because scss doesn't process the liquid filter -->
    body {
      background-image: url("/assets/paperbg.png");
    }
  </style>
  <link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Wind and Water" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Wind and Water</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a><a class="page-link" href="/posts/">Posts</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <section class='col span_1_of_4 post-list left-sidebar'>
  
    <h2 class="post-list-heading">Posts</h2>
    <ul class="post-list">
      
      <li>
        
        <span class="post-meta">Jan 9, 2019</span>
        <h3>
          <a class="post-link" href="/2019/01/sccm-and-git.html">
            SCCM and Git
          </a>
        </h3>
      </li>
      
      <li>
        
        <span class="post-meta">Apr 17, 2018</span>
        <h3>
          <a class="post-link" href="/2018/04/co-routines.html">
            Coroutines
          </a>
        </h3>
      </li>
      
      <li>
        
        <span class="post-meta">Apr 5, 2018</span>
        <h3>
          <a class="post-link" href="/2018/04/dock-io.html">
            Your Professional Pedigree
          </a>
        </h3>
      </li>
      
      <li>
        
        <span class="post-meta">Mar 21, 2018</span>
        <h3>
          <a class="post-link" href="/2018/03/tracking-fork-sources.html">
            Tracking the source of a fork
          </a>
        </h3>
      </li>
      
      <li>
        
        <span class="post-meta">Mar 18, 2018</span>
        <h3>
          <a class="post-link" href="/2018/03/the-dispossessed.html">
            The Dispossessed
          </a>
        </h3>
      </li>
      
      <li>
        
        <span class="post-meta">Mar 16, 2018</span>
        <h3>
          <a class="post-link" href="/2018/03/why-i-dont-use-fb.html">
            Why I&#39;m not on Facebook
          </a>
        </h3>
      </li>
      
      <li>
        
        <span class="post-meta">Mar 9, 2018</span>
        <h3>
          <a class="post-link" href="/2018/03/merging-structure.html">
            Merging migrations
          </a>
        </h3>
      </li>
      
      <li>
        
        <span class="post-meta">Mar 8, 2018</span>
        <h3>
          <a class="post-link" href="/2018/03/rebase-v-merge.html">
            Git merge v. rebase
          </a>
        </h3>
      </li>
      
      <li>
        
        <span class="post-meta">Feb 23, 2018</span>
        <h3>
          <a class="post-link" href="/2018/02/have-http-status.html">
            RSpec have HTTP status upgrade
          </a>
        </h3>
      </li>
      
    </ul>

    <p class="rss-subscribe">subscribe <a href="/feed.xml">via RSS</a></p>
  
</section>
<article class="post h-entry col span_3_of_4"
  itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">SCCM and Git</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2019-01-09T00:00:00-03:00" itemprop="datePublished">Jan 9, 2019
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>There are files in our software systems that we desire to have under
source control, but which we never edit. These are source code configuration
management (SCCM) files such as <code class="highlighter-rouge">Gemfile.lock</code>, <code class="highlighter-rouge">npm.shrinkwrap.json</code>,
or <code class="highlighter-rouge">db/schema.rb</code>.</p>

<p>Three examples in a <a href="https://rubyonrails.org/">Rails</a> application are
the <code class="highlighter-rouge">Gemfile.lock</code> for capturing the configuration of Ruby Gems
and <code class="highlighter-rouge">db/schema.rb</code> or <code class="highlighter-rouge">db/structure.sql</code> files that capture the schema
for the database.</p>

<p>An example in a <a href="https://nodejs.org/en/">node.js</a> application is the
<code class="highlighter-rouge">npm.shrinkwrap.json</code> file that captures the configuration of Node packages.</p>

<p>We don’t edit these files because they are generated by the development
platform as artifacts that capture software configuration.
We keep them under source control, in git, because they capture the current
configuration of dependencies, or of database structure, etc. for the
software system.</p>

<h2 id="merging-configuration-files">Merging configuration files</h2>
<p>So what happens when two developers make a change which requires regeneration
of one of these files? To be concrete, suppose two developers individually
update a gem using the <code class="highlighter-rouge">bundler</code> program, generating independent
versions of <code class="highlighter-rouge">Gemfile.lock</code>.</p>

<p>Whichever of these developers is second to commit, they will have to first
merge the other’s changes. Here is the ten dollar question: do we allow
git to merge the two versions of <code class="highlighter-rouge">Gemfile.lock</code>?</p>

<p>To answer it, let’s consider:</p>
<ul>
  <li>Would you think of editing this file by hand? Generally not.</li>
  <li>Will the git merge produce a file identical to the one that would result
if one developer had made both changes? Maybe. Maybe not.</li>
  <li>If git produced a merge conflict, would you reconsider editing by
hand to resolve the conflict? Would you be sure of the result?</li>
  <li>Suppose instead we’re talking about the database schema. Are you certain
that merge will always produce the schema that would result if one
developer had made both changes?</li>
</ul>

<p>Thinking about those questions, it seems prudent not to allow git to
merge these files. What we would prefer is that git leave our version
intact, announce that there is a conflict, and not commit the merge
until we have resolved it.</p>

<h3 id="preventing-automatic-merge-by-git">Preventing automatic merge by git</h3>
<p>We can tell git not to merge a file using the <code class="highlighter-rouge">.gitattributes</code> file.
The <code class="highlighter-rouge">.gitattributes</code> lives next to the <code class="highlighter-rouge">.git</code> directory in the root
of our project (and does not exist unless we create it).</p>

<p>The <code class="highlighter-rouge">man gitattributes</code> command produces a long list of configuration
options we can set for files managed by git. One of them is the “<code class="highlighter-rouge">merge</code>”
attribute, found under the heading, “Performing a three-way merge”.
Using the setting as follows:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Gemfile.lock -merge
</code></pre></div></div>
<p>in <code class="highlighter-rouge">.gitattributes</code> will unset merge for Gemfile.lock. Thus git will
“Take the version from the current branch as the tentative merge result,
and declare that the merge has conflicts.”</p>

<p>The setting,</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Gemfile.lock merge=binary
</code></pre></div></div>
<p>in <code class="highlighter-rouge">.gitattributes</code> will set merge to binary mode for Gemfile.lock. Thus
git will “Keep the version from your branch in the work tree,
but leave the path in the conflicted state for the user to sort out.”</p>

<p>Either method provides the desired result. In fact, they sound the same.
However it’s easy to experiment.</p>

<p>With <code class="highlighter-rouge">Gemfile.lock -merge</code>, on a conflict, we get the following:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>warning: Cannot merge binary files: Gemfile.lock (HEAD vs. &lt;commit-id&gt;)
Auto-merging Gemfile.lock
CONFLICT (content): Merge conflict in Gemfile.lock
Automatic merge failed; fix conflicts and then commit the result.
</code></pre></div></div>
<p>The <code class="highlighter-rouge">Gemfile.lock</code> file has the content from the local (our) version.
The <code class="highlighter-rouge">git status</code> command yields:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>On branch master
Your branch and 'origin/master' have diverged,
and have 1 and 1 different commits each, respectively.
  (use "git pull" to merge the remote branch into yours)

You have unmerged paths.
  (fix conflicts and run "git commit")
  (use "git merge --abort" to abort the merge)

Unmerged paths:
  (use "git add &lt;file&gt;..." to mark resolution)

	both modified:   Gemfile.lock

no changes added to commit (use "git add" and/or "git commit -a")
</code></pre></div></div>

<p>With <code class="highlighter-rouge">Gemfile.lock merge=binary</code>, on a conflict, we get identical outputs
and the file itself is treated identically.</p>

<h2 id="resolving-the-conflict">Resolving the conflict</h2>
<p>Resolution of the conflict means running whatever process is in place
for generating these files, in order to produce the generated content
as it should be. The artifacts from which these files are derived are
present in the merged result.</p>

<p>With <code class="highlighter-rouge">Gemfile.lock</code>, the independent changes to <code class="highlighter-rouge">Gemfile</code> have been merged.
(If there is a conflict for that file, we resolve it.) Then all we need
do is run bundler and add the resultant file to the merge:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bundle install
git add Gemfile.lock
</code></pre></div></div>

<p>The case for an <code class="highlighter-rouge">npm.shrinkwrap.json</code> file is analogous. The independent
changes to <code class="highlighter-rouge">package.json</code> have been merged. Running <code class="highlighter-rouge">npm install</code> will
generate a new shrinkwrap file that we can add to the commit.</p>

<p>With the database schema files managed by Rails, we picked-up the other
developer’s new migration in the merge. We run <code class="highlighter-rouge">rails db:migrate</code> to
not only make the needed changes to local development and test databases,
but also to produce a new <code class="highlighter-rouge">db/schema.rb</code> or <code class="highlighter-rouge">db/structure.sql</code> file that
we add to the merge commit.</p>

<h2 id="conclusion">Conclusion</h2>
<p>In order to properly manage generated SCCM files with git, we:</p>
<ol>
  <li>use the <code class="highlighter-rouge">.gitattributes</code> file to tell git not to merge them, ever,
but rather announce that there is a conflict.</li>
  <li>use our tooling to regenerate the files from the merged assets.</li>
  <li>add the newly generated files to the merge commit.</li>
</ol>


  </div><a class="u-url" href="/2019/01/sccm-and-git.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Wind and Water</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Douglas Lovell</li><li><a class="u-email" href="mailto:doug@wbreeze.com">doug@wbreeze.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/wbreeze"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">wbreeze</span></a></li><li><a href="/feed.xml"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#rss"></use></svg> <span>rss</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>The fascination of what&#39;s difficult...</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
